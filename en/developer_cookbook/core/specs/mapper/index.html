<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-developer_cookbook/core/specs/mapper">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-rc.1">
<script src="https://hm.baidu.com/hm.js?fd45d3e0a66aec212c9e87dcf4b45160" async></script><title data-rh="true">映射 | tKeel</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.tkeel.io/en/developer_cookbook/core/specs/mapper"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="映射 | tKeel"><meta data-rh="true" name="description" content="映射是指实体与实体之间属性实现计算、重组、赋值的规则。"><meta data-rh="true" property="og:description" content="映射是指实体与实体之间属性实现计算、重组、赋值的规则。"><link data-rh="true" rel="icon" href="/en/images/tkeel-logo-mark.svg"><link data-rh="true" rel="canonical" href="https://docs.tkeel.io/en/developer_cookbook/core/specs/mapper"><link data-rh="true" rel="alternate" href="https://docs.tkeel.io/en/developer_cookbook/core/specs/mapper" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.tkeel.io/developer_cookbook/core/specs/mapper" hreflang="zh-cn"><link data-rh="true" rel="alternate" href="https://docs.tkeel.io/developer_cookbook/core/specs/mapper" hreflang="x-default"><link rel="stylesheet" href="/en/assets/css/styles.716c939b.css">
<link rel="preload" href="/en/assets/js/runtime~main.d85d53fe.js" as="script">
<link rel="preload" href="/en/assets/js/main.ae3fee5c.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/en/"><div class="navbar__logo"><img src="/en/images/tkeel-logo-type-dark.svg" alt="tKeel" class="themedImage_ToTc themedImage--light_HNdA" height="28" width="149"><img src="/en/images/tkeel-logo-type-dark.svg" alt="tKeel" class="themedImage_ToTc themedImage--dark_i4oU" height="28" width="149"></div></a><a class="navbar__item navbar__link" href="/en/getting_started/guide">新手引导</a><a class="navbar__item navbar__link" href="/en/api/Core/tag">API</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/tkeel-io/tkeel" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/">什么是 tKeel ?</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/en/internal_concepts/platform">🏆 概念</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/en/getting_started/guide">🏁 开始行动</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/en/developer_cookbook/core/getting_started">📚 开发者手册</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/en/developer_cookbook/core/getting_started">Core</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/en/developer_cookbook/core/getting_started">快速入门</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/en/developer_cookbook/core/introduction/architecture">介绍</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/en/developer_cookbook/core/tutorial/iot-create-entity-from-model">教程</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/en/developer_cookbook/core/specs/entity">模块设计</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/en/developer_cookbook/core/specs/entity">实体</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/en/developer_cookbook/core/specs/mapper">映射</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/en/developer_cookbook/core/specs/model">模型</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/en/developer_cookbook/core/specs/relationship">关系</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/en/developer_cookbook/core/specs/actor">Actor</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/en/developer_cookbook/core/specs/channel">Channel</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/en/developer_cookbook/core/specs/persistent-strategy">数据持久化</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/en/developer_cookbook/core/specs/interfaces">Interfaces</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/en/developer_cookbook/core/specs/api-special-parameter">API Special Parameters</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/en/developer_cookbook/core/specs/proxy">Proxy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/en/developer_cookbook/core/specs/dispatch">Dispatch</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/en/developer_cookbook/core/specs/event">Event</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/en/developer_cookbook/core/specs/cache">Cache</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/en/developer_cookbook/tkeel_plugin/overview">tKeel 插件</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/en/developer_cookbook/security/SECURITY-001-how_designed">Security</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/en/developer_cookbook/device/devices/device">Devices</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/en/developer_cookbook/tools/do_not_repeat_youself">开发者工具</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/en/developer_cookbook/iothub/getting_started">iothub</a></div></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/roadmap">🗺️ Roadmap</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/FQA">🤔 答疑</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/en/develop_guide/before_develop/overview">📖开发指南</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/en/api/api_usage">🔎 API</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/en/base">🏁 解决方案</a></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/en/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">📚 开发者手册</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Core</span><meta itemprop="position" content="2"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">模块设计</span><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">映射</span><meta itemprop="position" content="4"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>映射</h1></header><blockquote><p>映射是指实体与实体之间属性实现计算、重组、赋值的规则。</p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="映射">映射<a class="hash-link" href="#映射" title="Direct link to heading">​</a></h2><p>我们通过配置 Entity1 和 Entity2 之间的映射，实现：</p><ul><li>Entity2.property1 = Entity1.property1</li><li>Entity2.property3 = Entity1.property3 + Entity1.property4</li></ul><p><img loading="lazy" alt="property-mapping" src="/en/assets/images/property-mapping-7b70848df498c464f9de80a66e64c36c.png" width="883" height="401" class="img_ev3q"></p><p>从实体的维度看来，实现映射，也就意味着我们通过映射规则实现了实体之间的通信。</p><p><img loading="lazy" alt="property-mapping-outline" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAyYAAAE1CAIAAACdiGN5AAAACXBIWXMAAA7EAAAOxAGVKw4bAAARBUlEQVR4nO3dP2yb553A8YdFEL6dRHgJu9QM4MC6yQIa2LopzHAIAwRnIYtV5IDocICjW2plCl0UMIMMVoArwk5WskS31LoWQTQIKH0dokxWp+imqLCByEvMAkFDTaaH4L2BjtukTmLJ/PEl6c9nsEWK5Pu89qtHX71/qFKe5wkAgEg/KnoAAADTT3IBAISTXAAA4SQXAEA4yQUAEE5yAQCEk1wAAOEkFwBAOMkFFOz5558veggA4Z4oegDAY61UKuV5Pviz6LEABLKXCyjM/dIaVFfRwwEIJLmAYnxrz5bqAqab5AIK8MAjiaoLmGKSCxi17zlzS3UB00pyASP1g2fKqy5gKkkuYHQe8spE1QVMH8kFjMih3glCdQFTRnIBo3CEd95SXcA0kVxAuCO/06nqAqaG5AJiPeI7y6suYDpILiDQUH6Tj+oCpoDkAqIM8Tcnqi5g0kkuIMTQf1O16gImmuQChm/ovTWguoDJJbmAIQvqrQHVBUwoyQUMU2hvDaguYBJJLmBoRtBbA6oLmDiSCxiOkfXWgOoCJovkAoZgxL01oLqACSK5gEdVSG8NqC5gUkgu4JEU2FsDqguYCJILOLrCe2tAdQHjT3IBRzQmvTWguoAxJ7mAoxir3hpQXcA4k1zAoY1hbw2oLmBsSS7gcMa2twZUFzCeJBdwCGPeWwOqCxhDkgt4WBPRWwOqCxg3kgt4KBPUWwOqCxgrkgv4YRPXWwOqCxgfkgv4ARPaWwOqCxgTkgv4PhPdWwOqCxgHkgv4TlPQWwOqCyic5AIebGp6a0B1AcWSXMADTFlvDaguoECSC/i2qeytAdUFFEVyAd9w+N7aXq6WKotr60tz1axSa6zu7G7c+7C9208ppf7u2uJ8rZJlldr88sZeSil11+pZaXZptdmYrWRZrb7S6aaUdptzpWx+pb08X6tkldnG6k4vpZT6exvL9dlKllVmG81ON339yEZzbXG2Mr+6d6gVVF1AISQX8DdH2r+VZVk66Kzt1FdXF6u3rrUWljrzq+2lWvdaq7XZS2m3tfSf/9Orr213mrW9d5ebG72UUpal9OdOp9Lc3F5bSB//Zrm13U9ZJZXv/mlze67d6azO965dXF7bTWm3tbj0bnd+bXtnbX6/vbi80UuDR+5sbGTL7WajetjVVF1AAXIeD1tbW61W65VXXjl9+vSxY8eK3u4YR5VK5Ugb1/ULx1P51OVP8zy/fuFkSicvXM/z/NPLp76+986XX355J8/z/LN3zpTTqTc+yfPb779QTjPn/nAn//pZp974JP/08qlyOn7hep7n+Z0/vDqTys9duf3JG6dSOvnGJ/ngRcszZ6/eGTzyqVcHzz+iSqVS9D853HPs2LHTp0+/8sorly5d2traeoTtmvH1RNGbGeFu3759/vz5p59++tixYy+++OIvfvGLEydOqC4e6OhncVWr1ZRSpZqlclarppSyLCvf7aeUUndndWllfWev10/p7t108v5zKtVKdu/vcur2eimllMrVWiWllLJKpZJSr9fr9bop/aU9n7VTSunu3ZTt76e5lFK5OlvLRr+mEOCvf/3rzZs3b9y4cfPmzWvXrq2trb333ns/+clPih4XwyS5ptzHH3/885///L333nvppZeKHgsTIM/zobfIzury29fShevd9nx3dX7uYu/+Z3rdbj+lLHX3u3dTZVBa6W53r5vSbOp3u72UapVKpVJNqbK82VmZHTwtq9RSN6WU9BZTY7CX6/Tp04ObW1tbP/vZz37729/W6/VCx8UwOZdrmm1tbV28ePHzzz/XWzy8fNjnOfX7/ZRSv7u/vb66sZdSb393f5Bd/c7qykZnc3V181Y6Xq/fK6ru5mpzs7PRXO0clOca9ercQuNkeb+zsb3f3d9sLi6ubHYfaTx6i/H30ksvff7557/85S+3traKHgtDI7mm2fnz5z/44IOiR8HkGW511Vda50521xcbze362vrSqf5ms9k5SCml6sJCZX15qbWTvXB5vTU/2GlVnl1o9NrLS2t71bPttZXZlOZbm2uLle2Vxj83Vvdqi83F2aMPRm8xQT744IPz588XPQqGxuwztd588808z1utVtEDYVKF1kl3vVH7973l6/vt+b+7d291bq6VtXZ3mo9QVd9NbzFxWq1WqVS6dOlS0QNhCOzlmk5fffXV7373u9dff73ogTDBhn6EsVh6i0n0+uuv//73v//qq6+KHghDILmm08HBQbfbnZmZKXogTLapqS69xYSamZm5ffv2wcFB0QNhCFyxOJ1u3rx54sSJokfBNIi4hjGlVF3q9Jf+4d7Z5m6/OdwF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" width="806" height="309" class="img_ev3q"></p><p>我们通过对此过程的分析，可将这一过程分为三个阶段：</p><ol><li>传递：实现实体之间数据的传递（写复制）。</li><li>计算：根据映射规则计算得到输出。</li><li>更新：使用计算得到的输出结果更新目标实体。</li></ol><h4 class="anchor anchorWithStickyNavbar_LWe7" id="映射规则">映射规则<a class="hash-link" href="#映射规则" title="Direct link to heading">​</a></h4><p>我们提供了两类映射规则实现： Expression，TQL。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="expression">Expression<a class="hash-link" href="#expression" title="Direct link to heading">​</a></h2><p>表达式，使用简单的语法来对实体属性的赋值方式进行设置：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">device123.temp </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> device234.temp</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如存在实体 device123 和 device234， 我们为 device123 配置表达式：<code>device123.temp = device234.temp</code>。次表达式实现使用 device234.temp 属性更新 device123.temp 属性。</p><p>使用 core 接口创建此 Expression：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> --location --request POST </span><span class="token string" style="color:#e3116c">&#x27;http://192.168.123.9:32758/v1/entities/device123/expressions?type=DEVICE&amp;owner=admin&amp;source=dm&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--header </span><span class="token string" style="color:#e3116c">&#x27;Content-Type: application/json&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--data-raw </span><span class="token string" style="color:#e3116c">&#x27;{</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;expressions&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            &quot;name&quot;: &quot;setTemp&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            &quot;path&quot;: &quot;temp&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            &quot;expression&quot;: &quot;device234.temp&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            &quot;description&quot;: &quot;使用设备实体 device234 的 temp 属性更新设备实体 device123 的 temp 属性。&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">}&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p><em>notes: 更多 APIs 详细信息请查看 <a href="https://docs.tkeel.io/api/Core/tag" target="_blank" rel="noopener noreferrer">APIs docs</a>。</em></p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="表达式资源定义">表达式资源定义<a class="hash-link" href="#表达式资源定义" title="Direct link to heading">​</a></h3><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> Expression </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// expression identifier.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ID </span><span class="token builtin">string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// target path.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Path </span><span class="token builtin">string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// expression name.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Name </span><span class="token builtin">string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// expression type, enum{ sub | eval}.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Type </span><span class="token builtin">string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// expression owner.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Owner </span><span class="token builtin">string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// entity id.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    EntityID </span><span class="token builtin">string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// expression text.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Expression </span><span class="token builtin">string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// expression description.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Description </span><span class="token builtin">string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>表达式作为一种元数据资源被 core::node 同步并解析处理。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="表达式解析">表达式解析<a class="hash-link" href="#表达式解析" title="Direct link to heading">​</a></h3><p>表达式中指定了该表达式计算输入需要的实体ID和实体属性。通过对表达式的解析我们可以得到这些信息，解析结果输出如下：</p><p><img loading="lazy" alt="expression-parse-delivery" src="/en/assets/images/expression-parse-delivery-4f3a32d97590a5b64cecb46ea9af7ed3.png" width="452" height="395" class="img_ev3q"></p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> ExpressionInfo </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// embeded Expression.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dao</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Expression</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// expression 所属 entity 是否属于当前 runtime.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    isHere        </span><span class="token builtin">bool</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    version       </span><span class="token builtin">int</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// subscribe endpoint</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    subEndpoints  </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">SubEndpoint</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// eval endpoint.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    evalEndpoints </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">EvalEndpoint</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> SubEndpoint </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    path         </span><span class="token builtin">string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    target       </span><span class="token builtin">string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    runtimeID   </span><span class="token builtin">string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    expressionID </span><span class="token builtin">string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> EvalEndpoint </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    path        </span><span class="token builtin">string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    target      </span><span class="token builtin">string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    expresionID </span><span class="token builtin">string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>我们解析 Expression 得到多个 ExpressionInfo，然后将 ExpressionInfo 加载到对应的 Runtime 中：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">    前提：</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">        1. 存在 设备 device234，device345 和 device123</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">        2. 存在两个 runtime</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">            1. device123 和 device234 运行在 runtime1 上</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">            2. device345 运行在 runtime2 上</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="display:inline-block;color:#999988;font-style:italic"></span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">*/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// expression demo.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;admin.device123.temp&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;sum device temp&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">path</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;temp&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">type</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;eval&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">owner</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;admin&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">entity_id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;device123&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">expression</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;device234.temp + device345.temp&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">description</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;求和 device234 和 device345 的 temp 属性&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// call func parseExpression(expr dao.Expression, version int) (map[string]*ExpressionInfo, error) .</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// =&gt; result:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">&quot;runtime1&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// embed Expression</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">isHere</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">version</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">subEndpoints</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token literal-property property" style="color:#36acaa">path</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;device234.properties.temp&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token literal-property property" style="color:#36acaa">target</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;device123&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token literal-property property" style="color:#36acaa">runtimeID</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;runtime1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token literal-property property" style="color:#36acaa">expressionID</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;admin.device123.temp&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">evalEndpoints</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token literal-property property" style="color:#36acaa">path</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;device234.properties.temp&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token literal-property property" style="color:#36acaa">target</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;device123&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token literal-property property" style="color:#36acaa">expressionID</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;admin.device123.temp&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token literal-property property" style="color:#36acaa">path</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;device345.properties.temp&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token literal-property property" style="color:#36acaa">target</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;device123&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token literal-property property" style="color:#36acaa">expressionID</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;admin.device123.temp&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">&quot;runtime2&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// embed Expression</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">isHere</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">version</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">subEndpoints</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token literal-property property" style="color:#36acaa">path</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;device345.properties.temp&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token literal-property property" style="color:#36acaa">target</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;device123&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token literal-property property" style="color:#36acaa">runtimeID</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;runtime2&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token literal-property property" style="color:#36acaa">expressionID</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;admin.device123.temp&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">evalEndpoints</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="expression-在-runtime-挂载">Expression 在 Runtime 挂载<a class="hash-link" href="#expression-在-runtime-挂载" title="Direct link to heading">​</a></h3><p>在 Runtime 模块中我们构建 <code>subTree</code> 和 <code>evalTree</code> 来匹配实体属性更新 path 和映射监听 path，以此完成映射的 <code>传递</code> 和 <code>计算</code> 两个阶段。</p><p><img loading="lazy" alt="expression-parse-and-mount" src="/en/assets/images/expression-parse-and-mount-c9179e26f64496296e758ca18ad8fdf1.png" width="895" height="797" class="img_ev3q"></p><p>ExpressionInfo 中的 subEndpoints 中的端点挂载到 subTree 中，用于在实体状态更新后，配更新实体属性的订阅者，如果存在，则根据 SubEndpoint 将变更属性发送给订阅者；evalEndpoints 中的端点挂载到 Runtime 中的 evalTree，用于订阅者收到订阅消息之后，匹配计算表达式，通过计算表达式计算结果。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="path-匹配原则">Path 匹配原则<a class="hash-link" href="#path-匹配原则" title="Direct link to heading">​</a></h3><p>当实体的属性变更之后，我们需要知道其订阅者是谁，就需要通过变更属性的path（<code>eg: device234.properties.temp</code>）。</p><p>匹配原则：</p><ul><li>匹配变更path的所有前缀path。</li><li>匹配所有以变更path为前缀的 path。</li><li>支持模糊匹配。</li></ul><p><img loading="lazy" alt="mapper-trie-tree-match" src="/en/assets/images/mapper-trie-tree-match-e1628f4d3614a71e76ec4c3d92b77aa6.png" width="818" height="772" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="匹配变更path的所有前缀path">匹配变更path的所有前缀path<a class="hash-link" href="#匹配变更path的所有前缀path" title="Direct link to heading">​</a></h4><p>在 JSON 中，内层字段值发生变更，包含此变更字段的对象也就发生了变更：</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;a&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;b&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;d&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">20</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;c&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">800</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 当 a.b.d 发生变化，那么a, a.b 都包含了变更。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>所以当 path: <code>device234.properties.temp</code> 发生变更，下列 path 的订阅者都能收到变更：</p><ol><li>device234.*</li><li>device234.properties</li><li>device234.properties.temp</li></ol><h4 class="anchor anchorWithStickyNavbar_LWe7" id="匹配所有以变更path为前缀的-path">匹配所有以变更path为前缀的 path<a class="hash-link" href="#匹配所有以变更path为前缀的-path" title="Direct link to heading">​</a></h4><p>JSON 中外层的字段发生变更，我们判定为其变更字段包含的内层字段同样发生变更：</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;a&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;b&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;d&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">20</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;c&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">800</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 当 a.b 发生变化，那么判定为 a.b.d 也发生了变更。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="支持模糊匹配">支持模糊匹配<a class="hash-link" href="#支持模糊匹配" title="Direct link to heading">​</a></h4><ul><li>Separator： <code>.</code></li><li>WildcardOne:  <code>+</code>,</li><li>WildcardSome: <code>*</code>,</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="tql">TQL<a class="hash-link" href="#tql" title="Direct link to heading">​</a></h2><p>TQL 不是一套独立的规则描述，TQL 是一个或多个 Expression 的复合体，且其与 Expression 的使用场景有所区别。</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># demo TQL Text.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">insert</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">into</span><span class="token plain"> device123</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">device234</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">temp</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">temp</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">device234</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">status</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">status</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>一条 TQL 语句可以转换成多条 Expression，由此我么可以通过 TQL 创建批量创建 Expression。</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// TQL =&gt; Expressions:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;admin.device123.temp&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;sync device temp&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">path</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;temp&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">type</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;eval&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">owner</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;admin&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">entity_id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;device123&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">expression</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;device234.temp&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;admin.device123.status&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;sync device status&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">path</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;status&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">type</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;eval&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">owner</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;admin&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">entity_id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;device123&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">expression</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;device234.status&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>当然我们更多使用 TQL 用于实体数据的订阅，而非映射，映射可以直接使用 Expression 得到更好的表达。</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">insert</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">into</span><span class="token plain"> sub123 </span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> device123</span><span class="token punctuation" style="color:#393A34">.</span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> device234</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">properties</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">temp</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> device345</span><span class="token punctuation" style="color:#393A34">.</span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="runtime-之间的数据订阅">Runtime 之间的数据订阅<a class="hash-link" href="#runtime-之间的数据订阅" title="Direct link to heading">​</a></h2><p>实体存在于 Runtime 内部，实体之间的通信可以基于Runtime之间的通信来完成，且更加高效。</p><p><img loading="lazy" alt="mapper-tentacles" src="/en/assets/images/mapper-tentacles-89ac5de5e20a3a8933f7ad0d0508e676.png" width="1041" height="325" class="img_ev3q"></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/tkeel-io/docs/tree/main/docs/developer_cookbook/core/specs/mapper.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2022-04-27T05:42:45.000Z">Apr 27, 2022</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/en/developer_cookbook/core/specs/entity"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">实体</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/en/developer_cookbook/core/specs/model"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">模型</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#映射" class="table-of-contents__link toc-highlight">映射</a></li><li><a href="#expression" class="table-of-contents__link toc-highlight">Expression</a><ul><li><a href="#表达式资源定义" class="table-of-contents__link toc-highlight">表达式资源定义</a></li><li><a href="#表达式解析" class="table-of-contents__link toc-highlight">表达式解析</a></li><li><a href="#expression-在-runtime-挂载" class="table-of-contents__link toc-highlight">Expression 在 Runtime 挂载</a></li><li><a href="#path-匹配原则" class="table-of-contents__link toc-highlight">Path 匹配原则</a></li></ul></li><li><a href="#tql" class="table-of-contents__link toc-highlight">TQL</a></li><li><a href="#runtime-之间的数据订阅" class="table-of-contents__link toc-highlight">Runtime 之间的数据订阅</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">文档</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/en/">什么是 tKeel</a></li><li class="footer__item"><a class="footer__link-item" href="/en/internal_concepts/platform">概念</a></li><li class="footer__item"><a class="footer__link-item" href="/en/getting_started/guide">新手引导</a></li></ul></div><div class="col footer__col"><div class="footer__title">社区</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/tkeel-io/tkeel" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 tKeel. Built with Docusaurus.</div></div></div></footer></div>
<script src="/en/assets/js/runtime~main.d85d53fe.js"></script>
<script src="/en/assets/js/main.ae3fee5c.js"></script>
</body>
</html>